<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Sistema de Controle de Clientes e Veículos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container py-4">
        <header class="bg-primary text-white p-3 rounded mb-4 shadow">
            <h1 class="text-center mb-3">Sistema de Controle de Clientes e Veículos</h1>
            <nav>
                <ul class="nav nav-pills justify-content-center">
                    <li class="nav-item"><a href="index.html" class="nav-link text-white"><i class="fas fa-home me-2"></i> Início</a></li>
                    <li class="nav-item"><a href="cadastro.html" class="nav-link active"><i class="fas fa-user-plus me-2"></i> Cadastro</a></li>
                    <li class="nav-item"><a href="consulta.html" class="nav-link text-white"><i class="fas fa-search me-2"></i> Consulta</a></li>
                    <li class="nav-item"><a href="lista-servicos.html" class="nav-link text-white"><i class="fas fa-tools me-2"></i> Serviços</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <div class="form-container">
                <div class="d-flex align-items-center mb-3">
                    <button onclick="window.history.back()" class="btn btn-secondary me-2">
                        <i class="fas fa-arrow-left me-1"></i>Voltar
                    </button>
                    <h2 class="mb-0">Cadastro de Cliente e Veículo</h2>
                </div>
                
                <div class="tabs nav nav-tabs mb-3">
                    <button class="tab-btn nav-link active" data-tab="client">Cliente</button>
                    <button class="tab-btn nav-link" data-tab="vehicle">Veículo</button>
                </div>
                
                <!-- Formulário de Cliente -->
                <div class="tab-content active" id="client-tab">
                    <form id="clientForm" class="needs-validation" novalidate>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="clientName" class="form-label">Nome Completo</label>
                                <input type="text" id="clientName" name="clientName" class="form-control" required>
                                <div class="invalid-feedback">
                                    Por favor, informe o nome do cliente.
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="clientPhone" class="form-label">Telefone</label>
                                <input type="tel" id="clientPhone" name="clientPhone" class="form-control" placeholder="(00) 00000-0000" required>
                                <div class="invalid-feedback">
                                    Por favor, informe o telefone do cliente.
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="clientEmail" class="form-label">E-mail</label>
                                <input type="email" id="clientEmail" name="clientEmail" class="form-control">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="clientDocument" class="form-label">CPF/CNPJ</label>
                                <input type="text" id="clientDocument" name="clientDocument" class="form-control">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="clientAddress" class="form-label">Endereço</label>
                            <input type="text" id="clientAddress" name="clientAddress" class="form-control">
                        </div>
                        
                        <div class="form-buttons d-flex gap-2 justify-content-end">
                            <button type="reset" class="btn btn-secondary">Limpar</button>
                            <button type="submit" class="btn btn-primary">Cadastrar Cliente</button>
                        </div>
                    </form>
                </div>
                
                <!-- Formulário de Veículo -->
                <div class="tab-content" id="vehicle-tab">
                    <form id="vehicleForm">
                        <div class="form-group">
                            <label for="vehicleClient">Cliente</label>
                            <select id="vehicleClient" name="vehicleClient" required>
                                <option value="">Selecione um cliente</option>
                                <!-- Opções serão preenchidas via JavaScript -->
                            </select>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vehiclePlate">Placa</label>
                                <input type="text" id="vehiclePlate" name="vehiclePlate" placeholder="ABC1234" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleModel">Modelo</label>
                                <input type="text" id="vehicleModel" name="vehicleModel" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vehicleYear">Ano</label>
                                <input type="text" id="vehicleYear" name="vehicleYear">
                            </div>
                            
                            <div class="form-group">
                                <label for="vehicleColor">Cor</label>
                                <input type="text" id="vehicleColor" name="vehicleColor">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="vehicleNotes">Observações</label>
                            <textarea id="vehicleNotes" name="vehicleNotes"></textarea>
                        </div>
                        
                        <div class="form-buttons">
                            <button type="submit">Cadastrar Veículo</button>
                            <button type="reset" class="secondary">Limpar</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>

        <footer class="mt-4 text-center text-muted">
            <p>&copy; 2023 Sistema de Controle de Clientes e Veículos</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
    <script>
        // Código específico para a página de cadastro
        function initCadastro() {
            // Controle das abas
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove classe active de todos os botões e conteúdos
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Adiciona classe active ao botão clicado e conteúdo correspondente
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Carrega clientes para o select
            const clientSelect = document.getElementById('vehicleClient');
            const data = loadData();
            
            data.clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                clientSelect.appendChild(option);
            });
            
            // Verifica se estamos editando um cliente existente
            const urlParams = new URLSearchParams(window.location.search);
            const editClientId = urlParams.get('editClient');
            let clientToEdit = null;
            
            if (editClientId) {
                clientToEdit = data.clients.find(c => c.id === parseInt(editClientId));
                if (clientToEdit) {
                    // Preenche o formulário com os dados do cliente
                    document.getElementById('clientName').value = clientToEdit.name || '';
                    document.getElementById('clientPhone').value = clientToEdit.phone || '';
                    document.getElementById('clientEmail').value = clientToEdit.email || '';
                    document.getElementById('clientDocument').value = clientToEdit.document || '';
                    document.getElementById('clientAddress').value = clientToEdit.address || '';
                    
                    // Muda o texto do botão
                    document.querySelector('#clientForm button[type="submit"]').textContent = 'Atualizar Cliente';
                    
                    // Adiciona botão para excluir
                    const deleteBtn = document.createElement('button');
                    deleteBtn.type = 'button';
                    deleteBtn.className = 'btn btn-danger';
                    deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i> Excluir Cliente';
                    deleteBtn.addEventListener('click', function() {
                        if (confirm('Tem certeza que deseja excluir este cliente? Todos os veículos e serviços associados também serão excluídos.')) {
                            // Remove veículos do cliente
                            const clientVehicles = data.vehicles.filter(v => v.clientId === clientToEdit.id);
                            clientVehicles.forEach(vehicle => {
                                // Remove serviços do veículo
                                data.services = data.services.filter(s => s.vehicleId !== vehicle.id);
                            });
                            
                            // Remove veículos
                            data.vehicles = data.vehicles.filter(v => v.clientId !== clientToEdit.id);
                            
                            // Remove cliente
                            data.clients = data.clients.filter(c => c.id !== clientToEdit.id);
                            
                            // Salva os dados
                            localStorage.setItem('systemData', JSON.stringify(data));
                            
                            alert('Cliente excluído com sucesso!');
                            window.location.href = 'consulta.html';
                        }
                    });
                    
                    document.querySelector('.form-buttons').appendChild(deleteBtn);
                }
            }
            
            // Formulário de cliente
            const clientForm = document.getElementById('clientForm');
            clientForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (clientToEdit) {
                    // Atualiza o cliente existente
                    clientToEdit.name = document.getElementById('clientName').value;
                    clientToEdit.phone = document.getElementById('clientPhone').value;
                    clientToEdit.email = document.getElementById('clientEmail').value;
                    clientToEdit.document = document.getElementById('clientDocument').value;
                    clientToEdit.address = document.getElementById('clientAddress').value;
                    
                    // Salva os dados
                    localStorage.setItem('systemData', JSON.stringify(data));
                    
                    alert('Cliente atualizado com sucesso!');
                    window.location.href = 'consulta.html';
                } else {
                    // Cria um novo cliente
                    const newClient = {
                        id: data.clients.length > 0 ? Math.max(...data.clients.map(c => c.id)) + 1 : 1,
                        name: document.getElementById('clientName').value,
                        phone: document.getElementById('clientPhone').value,
                        email: document.getElementById('clientEmail').value,
                        document: document.getElementById('clientDocument').value,
                        address: document.getElementById('clientAddress').value
                    };
                    
                    // Adiciona o novo cliente
                    data.clients.push(newClient);
                    
                    // Salva os dados
                    localStorage.setItem('systemData', JSON.stringify(data));
                    
                    alert('Cliente cadastrado com sucesso!');
                    clientForm.reset();
                    
                    // Atualiza o select de clientes
                    const option = document.createElement('option');
                    option.value = newClient.id;
                    option.textContent = newClient.name;
                    clientSelect.appendChild(option);
                }
            });
            
            // Formulário de veículo
            const vehicleForm = document.getElementById('vehicleForm');
            vehicleForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const clientId = parseInt(document.getElementById('vehicleClient').value);
                
                if (!clientId) {
                    alert('Por favor, selecione um cliente.');
                    return;
                }
                
                const newVehicle = {
                    id: data.vehicles.length > 0 ? Math.max(...data.vehicles.map(v => v.id)) + 1 : 1,
                    clientId: clientId,
                    plate: document.getElementById('vehiclePlate').value.toUpperCase(),
                    model: document.getElementById('vehicleModel').value,
                    year: document.getElementById('vehicleYear').value,
                    color: document.getElementById('vehicleColor').value,
                    notes: document.getElementById('vehicleNotes').value
                };
                
                // Verifica se já existe um veículo com a mesma placa
                const plateExists = data.vehicles.some(v => v.plate === newVehicle.plate);
                if (plateExists) {
                    alert('Já existe um veículo cadastrado com esta placa.');
                    return;
                }
                
                // Adiciona o novo veículo
                data.vehicles.push(newVehicle);
                
                // Salva os dados
                localStorage.setItem('systemData', JSON.stringify(data));
                
                alert('Veículo cadastrado com sucesso!');
                vehicleForm.reset();
            });
        }
    </script>
</body>
</html>